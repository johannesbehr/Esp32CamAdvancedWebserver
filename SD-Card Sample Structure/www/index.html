<!DOCTYPE HTML><html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon"  type="image/png" href="favicon.png">
<link rel="stylesheet" href="/css/menu.css">
<link rel="stylesheet" type="text/css" href="/css/style.css">
  <title>ESP Web Server</title>
    
</head>
<body>
<script src="/js/menu.js"></script>
<link rel="stylesheet" href="/css/menu.css">
  
  <h1>ESP32-Servosteuerung</h1>
  <p>This page was built with files from a microSD card.</p>
  <img src="/cam/stream"></img>
  
  <h2>Servo an Pin 12</h2>
  <div class="slider-container">
    <div class="slider-label">
      <label for="servoSlider">Servo-Winkel (0–180°):</label>
      <span id="angleValue_12" class="angle-display">90°</span>
    </div>
	<input type="range" id="servoSlider" min="0" max="180" value="90" 
	       step="1" oninput="handleSliderChange(this.value, 12)" />
  </div>
<div style="margin-top: 2rem;">
	  <h3>LED an GPIO 4</h3>
	  <!--
	  <button onclick="sendSetGpio(4,1)">GPIO 4 EIN</button>
	  <button onclick="sendSetGpio(4,0)">GPIO 4 AUS</button>-->
	  
	<label style="display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem; cursor: pointer;">
		<input type="checkbox" id="gpio4Toggle" onchange="sendSetGpio(4, this.checked?1:0)" style="width: 20px; height: 20px;" />
			GPIO 4 EIN
		</label>

	</div>

  
  
    <script>
  let lastSent = -1;
  let debounceTimeout;

  function handleSliderChange(value, pin) {
    displayAngle(value, pin);

    // Optionales Debounce, um zu häufige Requests zu vermeiden
    if (debounceTimeout) clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
      if (parseInt(value) !== lastSent) {
        sendServoCommand(pin, value);
        lastSent = parseInt(value);
      }
    }, 50);  // 50 ms debounce
  }

    function displayAngle(val, pin) {
      document.getElementById('angleValue_' + pin).textContent = val + "°";
    }

    function sendServoCommand(pin, angle) {
      const cmd = `servo:write ${pin} ${angle}`;
      sendScpi(cmd);
    }

	function sendSetGpio(pin, state) {
		const cmd = `gpio:digitalwrite ${pin} ${state}`;
		sendScpi(cmd); 
	}

    function sendScpi(cmd) {
      const encodedCmd = encodeURIComponent(cmd);
      const url = `/scpi?cmd=${encodedCmd}`;

      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP-Fehler: ${response.status}`);
          }
          return response.text();
        });
    }

  </script>

  
</body>
</html>